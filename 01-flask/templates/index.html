<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Item Checking App</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Order Item Checking App</h1>

        <!-- File Upload Section -->
        <div class="mb-3">
            <label for="fileInput" class="form-label">Upload Order Data File (CSV or Excel):</label>
            <input type="file" class="form-control" id="fileInput">
        </div>
        <button class="btn btn-primary" id="uploadButton">Upload File</button>

        <hr>

        <!-- AWB Input Section -->
        <div id="awbSection" class="mb-3">
            <label for="awbInput" class="form-label">Enter or Scan AWB Number:</label>
            <input type="text" class="form-control" id="awbInput">
        </div>

        <!-- Items Display Section -->
        <div id="itemsSection" class="mb-3" style="display:none;">
            <h3>Items for AWB <span id="awbDisplay"></span></h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>SKU</th>
                        <th>Product Name</th>
                        <th>Quantity</th>
                    </tr>
                </thead>
                <tbody id="itemsTable"></tbody>
            </table>

            <!-- Item Barcode Input -->
            <label for="itemInput" class="form-label">Enter or Scan Item Barcode:</label>
            <input type="text" class="form-control" id="itemInput">
        </div>

        <!-- Alerts -->
        <div id="alertSection"></div>
    </div>

    <script>
        document.getElementById('uploadButton').onclick = async () => {
            const fileInput = document.getElementById('fileInput');
            if (!fileInput.files.length) return alert('Please upload a file.');

            const formData = new FormData();
            formData.append('file', fileInput.files[0]);

            const response = await fetch('/upload', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();
            alert(result.message || result.error);
        };

        document.getElementById('awbInput').onchange = async (e) => {
            const awbNumber = e.target.value;
            const response = await fetch('/check_awb', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ awb_number: awbNumber })
            });

            const result = await response.json();
            if (response.ok) {
                document.getElementById('awbDisplay').textContent = awbNumber;
                const itemsTable = document.getElementById('itemsTable');
                itemsTable.innerHTML = '';
                result.items.forEach(item => {
                    const row = `<tr>
                        <td>${item['SKU Reference No.']}</td>
                        <td>${item['Product Name']}</td>
                        <td>${item['Quantity']}</td>
                    </tr>`;
                    itemsTable.innerHTML += row;
                });

                document.getElementById('awbSection').style.display = 'none';
                document.getElementById('itemsSection').style.display = 'block';
            } else {
                alert(result.error);
            }
        };

        document.getElementById('itemInput').onchange = async (e) => {
            const itemBarcode = e.target.value;
            const response = await fetch('/check_item', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ item_barcode: itemBarcode })
            });

            const result = await response.json();
            alert(result.message || result.error);

            if (result.message && result.message.includes('All items scanned')) {
                document.getElementById('awbSection').style.display = 'block';
                document.getElementById('itemsSection').style.display = 'none';
            }
        };
    </script>
</body>
</html>
